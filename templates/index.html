{% extends "layout.html" %}

{% block title %} {{ super() }} {% endblock %}

{% block content %}


<script>
    function loadMap() {
      const location =  "{{ location["name"] | safe }}";
      const url = `https://maps.googleapis.com/maps/api/geocode/json?address=${location}&key=AIzaSyDnB3tMLA1yXIx_lRB4G0A3EOPHSA-yga0`
      fetch(url)
        .then(res => {
          return res.json()
        })
        .then(response => {
          const location = response.results[0]
          const mapSrc = `https://www.google.com/maps/embed/v1/place?q=place_id:${location.place_id}&key=AIzaSyDnB3tMLA1yXIx_lRB4G0A3EOPHSA-yga0`
          document.getElementById('map').src = mapSrc
        })
        .catch(console.log)
    }

    function redirection(){
        const selector = document.getElementById("locationSelect");
        const newIndex = selector.selectedIndex;
        window.location.href = "/"+newIndex;
    }
</script>

<div class="row">
    <div class="col-md-6">
        <iframe
                id="map"
                width="540"
                height="440"
                frameborder="0"
                style="border:0"
                src=""
                allowfullscreen
        ></iframe>

    </div>

    <div class="col-md-6">
        <div class="row-md-4">
            <div class="form-group">
                <a class="btn btn-warning pull-right" rel="noopener noreferrer" href="add-location" role="button">Add a
                    new location</a>
                <br><br>
                <label for="locationSelect"></label>
                <select class="form-control" id="locationSelect" onchange="redirection()"
                        onmousedown="if(this.options.length>4){this.size=4;}" onblur="this.size=0;">
                    {% for location_name in location_names %}
                    <option>{{location_name}}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        <div class="row-md-1 line_container">
            <div class="line"></div>
        </div>
        <div class="row-md-7">
            <br><br>
            <label id="locationTitle">{{ location["name"] }}</label><br>
            <label id="locationDescription">{{ location["description"] }}</label><br>
            <label id="locationPhoto"> {{ location["photo_url"] }} </label><br>
            <label id="locationReview"> {{ location["review"][0]["text"] }}</label><br>
            <label id="locationReview"> {{ location["review"][0]["author"] }}</label><br>
            <label id="locationReview"> {{ location["review"][0]["mark"] }}</label><br>
        </div>

        <image src={{ location["photo_url"] }}> </image>


        <div class="row">
            <div class="column-8 column-sm-6">

            </div>
            <div class="column-4 column-sm-6">

            </div>


        </div>

    </div>
    <script type="text/javascript">
        loadMap();
        var selector = document.getElementById("locationSelect");
        var url = window.location.href ;
        var index = url.substr(url.lastIndexOf('/') + 1);
        selector.selectedIndex = index ;

    </script>

    {% endblock %}
